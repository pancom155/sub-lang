<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Order Success | Zero Degree Café</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/aos@3.0.0-beta.6/dist/aos.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
    .success-card { background: #fff; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); padding: 30px; margin-top: 50px; transform: translateY(20px); opacity: 0; transition: all 0.6s ease-in-out; }
    .success-card.show { transform: translateY(0); opacity: 1; }
    .success-card h2 { font-weight: 700; color: #1d3c5a; }
    .order-items img { object-fit: cover; border-radius: 8px; transition: transform 0.3s ease; }
    .order-items li:hover img { transform: scale(1.05); }
    @media(max-width: 576px) {
      .success-card { padding: 20px; }
      .order-items li { flex-direction: column; align-items: flex-start; }
      .order-items .item-total { margin-top: 5px; }
    }
  </style>
</head>
<body>
<div class="container py-5">
  <div class="success-card mx-auto text-center" style="max-width: 900px;" data-aos="fade-up" data-aos-duration="800">

    <% if (!order) { %>
      <i class="bi bi-x-circle-fill text-danger" style="font-size:4rem;" data-aos="zoom-in"></i>
      <h3 class="mt-3" data-aos="fade-up">No Order Found</h3>
      <p class="text-muted" data-aos="fade-up" data-aos-delay="100">We couldn’t find any order details to display.</p>
      <a href="/cart" class="btn btn-primary mt-3 px-4" data-aos="fade-up" data-aos-delay="200">Back to Cart</a>
    <% } else { %>

      <i class="bi bi-check-circle-fill text-success" style="font-size:4rem;" data-aos="zoom-in"></i>
      <h2 class="mt-3" data-aos="fade-up">Thank You for Your Order!</h2>
      <p class="text-muted mb-4" data-aos="fade-up" data-aos-delay="100">Your order has been placed successfully.</p>

      <div class="text-start mb-4" data-aos="fade-up" data-aos-delay="200">
        <p><strong>Order ID:</strong> <span class="text-primary"><%= order._id %></span></p>
      <p><strong>Payment Mode:</strong> 
        <span class="badge bg-info text-dark">
          <%= order.paymentMode === 'Pay at the Counter' ? 'Pay at the Counter' : order.paymentMode %>
        </span>
      </p>
      </div>

      <div class="text-start mb-4" data-aos="fade-up" data-aos-delay="300">
        <h5>User Information</h5>
        <p class="mb-1"><strong>Name:</strong> <%= order.userInfoSnapshot.firstName %> <%= order.userInfoSnapshot.lastName %></p>
        <p class="mb-1"><strong>Email:</strong> <%= order.userInfoSnapshot.email %></p>
        <p class="mb-1"><strong>Phone:</strong> <%= order.userInfoSnapshot.phone %></p>
        <p class="mb-0"><strong>Address:</strong> <%= order.userInfoSnapshot.address %></p>
        <p><strong>Placed On:</strong> 
          <%= new Date(order.createdAt).toLocaleString('en-PH', { 
            timeZone: 'Asia/Manila',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
          }) %>
        </p>
      </div>

      <div class="text-start" data-aos="fade-up" data-aos-delay="400">
        <h5 class="mb-3">Items Ordered</h5>
        <ul class="list-group order-items">
        <% order.items.forEach(item => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap p-3">
            <div class="d-flex align-items-center">
              <% if (item.productId && item.productId.productImage) { %>
                <img src="<%= item.productId.productImage %>" 
                    alt="<%= item.productId.productName || 'No Image' %>" 
                    width="80" height="80" 
                    class="me-3 rounded shadow-sm border"
                    style="object-fit:cover;">
              <% } else { %>
                <img src="/images/no-image.jpg" 
                    alt="No Image" 
                    width="80" height="80" 
                    class="me-3 rounded shadow-sm border"
                    style="object-fit:cover;">
              <% } %>
              <div>
                <strong class="d-block"><%= item.productId?.productName || 'Unknown Product' %></strong>
                <small class="text-muted">Quantity: <%= item.quantity %></small>
              </div>
            </div>
            <span class="badge bg-primary fs-6 rounded-pill px-3 py-2">
              ₱<%= item.productId ? (item.productId.price * item.quantity).toFixed(2) : '0.00' %>
            </span>
          </li>
        <% }) %>
        </ul>
      </div>

      <div class="mt-4 text-end" data-aos="fade-up" data-aos-delay="500">
        <h5>Total:</h5>
        <p class="fs-3 fw-bold text-success">₱<%= order.totalAmount ? order.totalAmount.toFixed(2) : '0.00' %></p>
      </div>

        <% if (order.proofImage) { %>
          <div class="mt-5 text-start">
            <h5>Payment Proof</h5>
            <div class="text-center border rounded p-3 bg-light shadow-sm">
              <img src="<%= order.proofImage %>" 
                  alt="Proof of Payment" 
                  class="img-fluid rounded shadow">
              <% if(order.senderName || order.referenceNumber) { %>
                <p class="mb-1"><strong>Sender:</strong> <%= order.senderName || 'N/A' %></p>
                <p class="mb-1"><strong>Reference #:</strong> <%= order.referenceNumber || 'N/A' %></p>
              <% } %>
            </div>
          </div>
        <% } %>

      <div class="mt-4" data-aos="fade-up" data-aos-delay="700">
        <a href="/dashboard" class="btn btn-success mt-2 px-4">Back to Dashboard</a>
      </div>

    <% } %>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aos@3.0.0-beta.6/dist/aos.js"></script>
<script>
  AOS.init({ once: true, easing: 'ease-in-out', duration: 600 });
  window.addEventListener('load', () => {
    document.querySelector('.success-card').classList.add('show');
  });
</script>
</body>
</html>
